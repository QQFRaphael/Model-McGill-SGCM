#!/usr/bin/sh
expnum=1

while [ $expnum -le 1 ]
do

  echo $expnum
#===

#clean
#script to get Z500
#convert history file to single precision
#
BEGDAY=1.
ENDDAY=153.
ISTEP=1.
ITSTEPS=48

f77 -o getZ500pre getZ500pre.f

#INFILE=/mnt/climate/data/loach/jiaxj/Data/SGCM/OutData/SVD2/SVD2_Detrend_Tro/Enssum.dat
INFILE=/mnt/climate/data/loach/jiaxj/Data/SGCM/OutData/51Modelforcing/exp$expnum/OUTpred.monthly

echo 'running getZ500pre'

cat << /EOF | getZ500pre $INFILE
$BEGDAY
$ENDDAY
$ISTEP
/EOF


#prepare input to presmap
#
cat << /EOF > temphead
COMMON
  TEMPDIR=/zemo2/jiaxj/igcm/T21L5/EXPERIMENTS/iAMIP_1
  HOMEDIR=/zemo2/jiaxj/igcm/T21L5/EXPERIMENTS/iAMIP_1
  CURRENTDIR=/zemo2/jiaxj/igcm/T21L5/EXPERIMENTS/iAMIP_1
  BEGDAY=$BEGDAY
  ENDDAY=$ENDDAY
  DIAGNOSTICS=SG
  UTF=1.4
  LEVELTYPE=IS
  PRINT=T
  PLOT=F
  PRINTSIGFIG=3
  ASCIICHARS=2
  SCRATCH=F
  OROGRAPHY=F
  FREQSAMPLING=$ITSTEPS
  FREQPRINT=$ITSTEPS
/EOF
cat temphead presmap11.ZTSG > fort.10
#
#run presmap and smap
#
echo running presmap
./presmap11.out
ln -s data.res.sp fort.9

echo running smap
./smap11.out
#mv gridout /pike/jiaxj/igcm/Result/EXPInt/exp$expnum/Z500_monthly.dat
mv gridout /mnt/climate/data/loach/jiaxj/Data/SGCM/OutData/51Modelforcing/exp$expnum/Z500_monthly.dat
rm -f nrecsout 
rm -f temphead
rm -f fort.*
rm -f data.*
rm -f data.*
##--------

   expnum=`expr $expnum + 1`
done

