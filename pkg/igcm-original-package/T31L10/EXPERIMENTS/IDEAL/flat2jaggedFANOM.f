      PROGRAM SPECREAD
      COMPLEX Z(5120),D(5120),T(5120),SP(512),EZ,TADD,GMEAN,
     &WRK(5120)

C*****INITIALISE
      WW=7.292E-5
      EZ=(1.633,0.)
      GASCON=287.0
      RADEA=6371000.0
      CT=RADEA*RADEA*WW*WW/GASCON
      T0=250.
      TADD=-SQRT(2.)*T0/CT

      OPEN(10,FILE='T31.flatcoeffs',FORM='UNFORMATTED')
      REWIND 10
      OPEN(2,FILE='data.ideal',FORM='UNFORMATTED')
      REWIND 2

C*****CONVERT Z D T SP

      FACTOR=WW*WW
      GMEAN=(0.,0.)
      CALL FTOJ(Z,GMEAN,FACTOR,1,10)
      FACTOR=WW*WW
      GMEAN=(0.,0.)
      CALL FTOJ(D,GMEAN,FACTOR,2,10)
      FACTOR=CT*WW
      GMEAN=(0.,0.)
      CALL FTOJ(T,GMEAN,FACTOR,2,10)
      GMEAN=(0.,0.)
      CALL FTOJ(WRK,GMEAN,1.,2,1)
      DO I=1,512
      SP(I)=WRK(I)
      ENDDO

C*****OUTPUT

      WRITE(2)Z,D,T,SP

      STOP
      END

      SUBROUTINE FTOJ(X,GMEAN,FACTOR,IPARTY,NLEVS)
      COMPLEX X1(528),X2(512),XRD(512),X(5120),GMEAN

C*****LOOP OVER LEVELS
      DO 100 LEVEL=1,NLEVS

C*****READ IN DATA

      READ(10)X1

C*****FIRST CONVERT FLAT T31 TO JAGGED T31

      IFLT=0
      IJGD=0
      DO 10 M=0,30
      NFLT=32-M
      NJGD=INT((32.1-REAL(M))/2.)*2
      DO 20 I=1,NJGD
 20   X2(IJGD+I)=X1(IFLT+I)
      IJGD=IJGD+NJGD
      IFLT=IFLT+NFLT
 10   CONTINUE

C*****NEXT CONVERT SIMPLE JAGGED T31 TO 
C     READING MODEL DATA FORMAT
C     NOTE THAT ORDERING OF ODD AND EVEN COEFFS IS  
C     SWAPPED IF DEALING WITH VORTICITY (IPARTY=1) 
C     OR TEMPERATURE, DIVERGENCE AND S PRESS (IPARTY=2).

      IJGD1=0
      IJGD2=0
      DO 30 M=0,30
      NJGD1=INT((32.1-REAL(M))/2.)*2
      NJGD2=NJGD1/2
      DO 40 I=1,NJGD2
      XRD(IJGD2+I)=X2(IJGD1+2*I+1-IPARTY)
 40   CONTINUE
      IJGD2=IJGD2+NJGD2
      IJGD1=IJGD1+NJGD1
 30   CONTINUE
      IJGD1=0
      DO 50 M=0,30
      NJGD1=INT((32.1-REAL(M))/2.)*2
      NJGD2=NJGD1/2
      DO 60 I=1,NJGD2
      XRD(IJGD2+I)=X2(IJGD1+2*I-2+IPARTY)
 60   CONTINUE
      IJGD2=IJGD2+NJGD2
      IJGD1=IJGD1+NJGD1
 50   CONTINUE

C*****FEED DATA INTO BIG ARRAY
C     NONDIMENSIONALISE AND ADJUST GLOBAL MEAN 

      DO 70 I=1,512
      X(I+(LEVEL-1)*512)=XRD(I)/FACTOR
 70   CONTINUE
      X(1+(LEVEL-1)*512)=X(1+(LEVEL-1)*512) + GMEAN

 100  CONTINUE

      RETURN
      END
